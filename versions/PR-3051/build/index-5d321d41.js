function t(t){this.content=t}t.prototype={constructor:t,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?undefined:this.content[e+1]},update:function(e,r,i){var n=i&&i!=e?this.remove(i):this;var s=n.find(e),h=n.content.slice();if(s==-1){h.push(i||e,r)}else{h[s+1]=r;if(i)h[s]=i}return new t(h)},remove:function(e){var r=this.find(e);if(r==-1)return this;var i=this.content.slice();i.splice(r,2);return new t(i)},addToStart:function(e,r){return new t([e,r].concat(this.remove(e).content))},addToEnd:function(e,r){var i=this.remove(e).content.slice();i.push(e,r);return new t(i)},addBefore:function(e,r,i){var n=this.remove(r),s=n.content.slice();var h=n.find(e);s.splice(h==-1?s.length:h,0,r,i);return new t(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(e){e=t.from(e);if(!e.size)return this;return new t(e.content.concat(this.subtract(e).content))},append:function(e){e=t.from(e);if(!e.size)return this;return new t(this.subtract(e).content.concat(e.content))},subtract:function(e){var r=this;e=t.from(e);for(var i=0;i<e.content.length;i+=2)r=r.remove(e.content[i]);return r},toObject:function(){var t={};this.forEach((function(e,r){t[e]=r}));return t},get size(){return this.content.length>>1}};t.from=function(e){if(e instanceof t)return e;var r=[];if(e)for(var i in e)r.push(i,e[i]);return new t(r)};function e(t,r,i){for(let n=0;;n++){if(n==t.childCount||n==r.childCount)return t.childCount==r.childCount?null:i;let s=t.child(n),h=r.child(n);if(s==h){i+=s.nodeSize;continue}if(!s.sameMarkup(h))return i;if(s.isText&&s.text!=h.text){for(let t=0;s.text[t]==h.text[t];t++)i++;return i}if(s.content.size||h.content.size){let t=e(s.content,h.content,i+1);if(t!=null)return t}i+=s.nodeSize}}function r(t,e,i,n){for(let s=t.childCount,h=e.childCount;;){if(s==0||h==0)return s==h?null:{a:i,b:n};let l=t.child(--s),u=e.child(--h),f=l.nodeSize;if(l==u){i-=f;n-=f;continue}if(!l.sameMarkup(u))return{a:i,b:n};if(l.isText&&l.text!=u.text){let t=0,e=Math.min(l.text.length,u.text.length);while(t<e&&l.text[l.text.length-t-1]==u.text[u.text.length-t-1]){t++;i--;n--}return{a:i,b:n}}if(l.content.size||u.content.size){let t=r(l.content,u.content,i-1,n-1);if(t)return t}i-=f;n-=f}}class i{constructor(t,e){this.content=t;this.size=e||0;if(e==null)for(let e=0;e<t.length;e++)this.size+=t[e].nodeSize}nodesBetween(t,e,r,i=0,n){for(let s=0,h=0;h<e;s++){let l=this.content[s],u=h+l.nodeSize;if(u>t&&r(l,i+h,n||null,s)!==false&&l.content.size){let n=h+1;l.nodesBetween(Math.max(0,t-n),Math.min(l.content.size,e-n),r,i+n)}h=u}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,r,i){let n="",s=true;this.nodesBetween(t,e,((h,l)=>{let u=h.isText?h.text.slice(Math.max(t,l)-l,e-l):!h.isLeaf?"":i?typeof i==="function"?i(h):i:h.type.spec.leafText?h.type.spec.leafText(h):"";if(h.isBlock&&(h.isLeaf&&u||h.isTextblock)&&r){if(s)s=false;else n+=r}n+=u}),0);return n}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,r=t.firstChild,n=this.content.slice(),s=0;if(e.isText&&e.sameMarkup(r)){n[n.length-1]=e.withText(e.text+r.text);s=1}for(;s<t.content.length;s++)n.push(t.content[s]);return new i(n,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let r=[],n=0;if(e>t)for(let i=0,s=0;s<e;i++){let h=this.content[i],l=s+h.nodeSize;if(l>t){if(s<t||l>e){if(h.isText)h=h.cut(Math.max(0,t-s),Math.min(h.text.length,e-s));else h=h.cut(Math.max(0,t-s-1),Math.min(h.content.size,e-s-1))}r.push(h);n+=h.nodeSize}s=l}return new i(r,n)}cutByIndex(t,e){if(t==e)return i.empty;if(t==0&&e==this.content.length)return this;return new i(this.content.slice(t,e))}replaceChild(t,e){let r=this.content[t];if(r==e)return this;let n=this.content.slice();let s=this.size+e.nodeSize-r.nodeSize;n[t]=e;return new i(n,s)}addToStart(t){return new i([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new i(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return false;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return false;return true}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,r=0;e<this.content.length;e++){let i=this.content[e];t(i,r,e);r+=i.nodeSize}}findDiffStart(t,r=0){return e(this,t,r)}findDiffEnd(t,e=this.size,i=t.size){return r(this,t,e,i)}findIndex(t,e=-1){if(t==0)return s(0,t);if(t==this.size)return s(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let r=0,i=0;;r++){let n=this.child(r),h=i+n.nodeSize;if(h>=t){if(h==t||e>0)return s(r+1,h);return s(r,i)}i=h}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((t=>t.toJSON())):null}static fromJSON(t,e){if(!e)return i.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new i(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return i.empty;let e,r=0;for(let i=0;i<t.length;i++){let n=t[i];r+=n.nodeSize;if(i&&n.isText&&t[i-1].sameMarkup(n)){if(!e)e=t.slice(0,i);e[e.length-1]=n.withText(e[e.length-1].text+n.text)}else if(e){e.push(n)}}return new i(e||t,r)}static from(t){if(!t)return i.empty;if(t instanceof i)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new i([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}i.empty=new i([],0);const n={index:0,offset:0};function s(t,e){n.index=t;n.offset=e;return n}function h(t,e){if(t===e)return true;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return false;let r=Array.isArray(t);if(Array.isArray(e)!=r)return false;if(r){if(t.length!=e.length)return false;for(let r=0;r<t.length;r++)if(!h(t[r],e[r]))return false}else{for(let r in t)if(!(r in e)||!h(t[r],e[r]))return false;for(let r in e)if(!(r in t))return false}return true}class l{constructor(t,e){this.type=t;this.attrs=e}addToSet(t){let e,r=false;for(let i=0;i<t.length;i++){let n=t[i];if(this.eq(n))return t;if(this.type.excludes(n.type)){if(!e)e=t.slice(0,i)}else if(n.type.excludes(this.type)){return t}else{if(!r&&n.type.rank>this.type.rank){if(!e)e=t.slice(0,i);e.push(this);r=true}if(e)e.push(n)}}if(!e)e=t.slice();if(!r)e.push(this);return e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return true;return false}eq(t){return this==t||this.type==t.type&&h(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let r=t.marks[e.type];if(!r)throw new RangeError(`There is no mark type ${e.type} in this schema`);return r.create(e.attrs)}static sameSet(t,e){if(t==e)return true;if(t.length!=e.length)return false;for(let r=0;r<t.length;r++)if(!t[r].eq(e[r]))return false;return true}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return l.none;if(t instanceof l)return[t];let e=t.slice();e.sort(((t,e)=>t.type.rank-e.type.rank));return e}}l.none=[];class u extends Error{}class f{constructor(t,e,r){this.content=t;this.openStart=e;this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let r=a(this.content,t+this.openStart,e);return r&&new f(r,this.openStart,this.openEnd)}removeBetween(t,e){return new f(o(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};if(this.openStart>0)t.openStart=this.openStart;if(this.openEnd>0)t.openEnd=this.openEnd;return t}static fromJSON(t,e){if(!e)return f.empty;let r=e.openStart||0,n=e.openEnd||0;if(typeof r!="number"||typeof n!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new f(i.fromJSON(t,e.content),r,n)}static maxOpen(t,e=true){let r=0,i=0;for(let i=t.firstChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.firstChild)r++;for(let r=t.lastChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.lastChild)i++;return new f(t,r,i)}}f.empty=new f(i.empty,0,0);function o(t,e,r){let{index:i,offset:n}=t.findIndex(e),s=t.maybeChild(i);let{index:h,offset:l}=t.findIndex(r);if(n==e||s.isText){if(l!=r&&!t.child(h).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(r))}if(i!=h)throw new RangeError("Removing non-flat range");return t.replaceChild(i,s.copy(o(s.content,e-n-1,r-n-1)))}function a(t,e,r,i){let{index:n,offset:s}=t.findIndex(e),h=t.maybeChild(n);if(s==e||h.isText){if(i&&!i.canReplace(n,n,r))return null;return t.cut(0,e).append(r).append(t.cut(e))}let l=a(h.content,e-s-1,r);return l&&t.replaceChild(n,h.copy(l))}function c(t,e,r){if(r.openStart>t.depth)throw new u("Inserted content deeper than insertion position");if(t.depth-r.openStart!=e.depth-r.openEnd)throw new u("Inconsistent open depths");return p(t,e,r,0)}function p(t,e,r,i){let n=t.index(i),s=t.node(i);if(n==e.index(i)&&i<t.depth-r.openStart){let h=p(t,e,r,i+1);return s.copy(s.content.replaceChild(n,h))}else if(!r.content.size){return y(s,b(t,e,i))}else if(!r.openStart&&!r.openEnd&&t.depth==i&&e.depth==i){let i=t.parent,n=i.content;return y(i,n.cut(0,t.parentOffset).append(r.content).append(n.cut(e.parentOffset)))}else{let{start:n,end:h}=k(r,t);return y(s,S(t,n,h,e,i))}}function d(t,e){if(!e.type.compatibleContent(t.type))throw new u("Cannot join "+e.type.name+" onto "+t.type.name)}function w(t,e,r){let i=t.node(r);d(i,e.node(r));return i}function m(t,e){let r=e.length-1;if(r>=0&&t.isText&&t.sameMarkup(e[r]))e[r]=t.withText(e[r].text+t.text);else e.push(t)}function g(t,e,r,i){let n=(e||t).node(r);let s=0,h=e?e.index(r):n.childCount;if(t){s=t.index(r);if(t.depth>r){s++}else if(t.textOffset){m(t.nodeAfter,i);s++}}for(let t=s;t<h;t++)m(n.child(t),i);if(e&&e.depth==r&&e.textOffset)m(e.nodeBefore,i)}function y(t,e){t.type.checkContent(e);return t.copy(e)}function S(t,e,r,n,s){let h=t.depth>s&&w(t,e,s+1);let l=n.depth>s&&w(r,n,s+1);let u=[];g(null,t,s,u);if(h&&l&&e.index(s)==r.index(s)){d(h,l);m(y(h,S(t,e,r,n,s+1)),u)}else{if(h)m(y(h,b(t,e,s+1)),u);g(e,r,s,u);if(l)m(y(l,b(r,n,s+1)),u)}g(n,null,s,u);return new i(u)}function b(t,e,r){let n=[];g(null,t,r,n);if(t.depth>r){let i=w(t,e,r+1);m(y(i,b(t,e,r+1)),n)}g(e,null,r,n);return new i(n)}function k(t,e){let r=e.depth-t.openStart,n=e.node(r);let s=n.copy(t.content);for(let t=r-1;t>=0;t--)s=e.node(t).copy(i.from(s));return{start:s.resolveNoCache(t.openStart+r),end:s.resolveNoCache(s.content.size-t.openEnd-r)}}class v{constructor(t,e,r){this.pos=t;this.path=e;this.parentOffset=r;this.depth=e.length/3-1}resolveDepth(t){if(t==null)return this.depth;if(t<0)return this.depth+t;return t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){t=this.resolveDepth(t);return this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){t=this.resolveDepth(t);return t==0?0:this.path[t*3-1]+1}end(t){t=this.resolveDepth(t);return this.start(t)+this.node(t).content.size}before(t){t=this.resolveDepth(t);if(!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){t=this.resolveDepth(t);if(!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=t.child(e);return r?t.child(e).cut(r):i}get nodeBefore(){let t=this.index(this.depth);let e=this.pos-this.path[this.path.length-1];if(e)return this.parent.child(t).cut(0,e);return t==0?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let r=this.path[e*3],i=e==0?0:this.path[e*3-1]+1;for(let e=0;e<t;e++)i+=r.child(e).nodeSize;return i}marks(){let t=this.parent,e=this.index();if(t.content.size==0)return l.none;if(this.textOffset)return t.child(e).marks;let r=t.maybeChild(e-1),i=t.maybeChild(e);if(!r){let t=r;r=i;i=t}let n=r.marks;for(var s=0;s<n.length;s++)if(n[s].type.spec.inclusive===false&&(!i||!n[s].isInSet(i.marks)))n=n[s--].removeFromSet(n);return n}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let r=e.marks,i=t.parent.maybeChild(t.index());for(var n=0;n<r.length;n++)if(r[n].type.spec.inclusive===false&&(!i||!r[n].isInSet(i.marks)))r=r[n--].removeFromSet(r);return r}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);r>=0;r--)if(t.pos<=this.end(r)&&(!e||e(this.node(r))))return new E(this,t,r);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let r=[];let i=0,n=e;for(let e=t;;){let{index:t,offset:s}=e.content.findIndex(n);let h=n-s;r.push(e,t,i+s);if(!h)break;e=e.child(t);if(e.isText)break;n=h-1;i+=s+1}return new v(e,r,n)}static resolveCached(t,e){for(let r=0;r<x.length;r++){let i=x[r];if(i.pos==e&&i.doc==t)return i}let r=x[N]=v.resolve(t,e);N=(N+1)%O;return r}}let x=[],N=0,O=12;class E{constructor(t,e,r){this.$from=t;this.$to=e;this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const M=Object.create(null);class R{constructor(t,e,r,n=l.none){this.type=t;this.attrs=e;this.marks=n;this.content=r||i.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,r,i=0){this.content.nodesBetween(t,e,r,i,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,r,i){return this.content.textBetween(t,e,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,r){return this.type==t&&h(this.attrs,e||t.defaultAttrs||M)&&l.sameSet(this.marks,r||l.none)}copy(t=null){if(t==this.content)return this;return new R(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new R(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){if(t==0&&e==this.content.size)return this;return this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,r=false){if(t==e)return f.empty;let i=this.resolve(t),n=this.resolve(e);let s=r?0:i.sharedDepth(e);let h=i.start(s),l=i.node(s);let u=l.content.cut(i.pos-h,n.pos-h);return new f(u,i.depth-s,n.depth-s)}replace(t,e,r){return c(this.resolve(t),this.resolve(e),r)}nodeAt(t){for(let e=this;;){let{index:r,offset:i}=e.content.findIndex(t);e=e.maybeChild(r);if(!e)return null;if(i==t||e.isText)return e;t-=i+1}}childAfter(t){let{index:e,offset:r}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:r}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:e,offset:r}=this.content.findIndex(t);if(r<t)return{node:this.content.child(e),index:e,offset:r};let i=this.content.child(e-1);return{node:i,index:e-1,offset:r-i.nodeSize}}resolve(t){return v.resolveCached(this,t)}resolveNoCache(t){return v.resolve(this,t)}rangeHasMark(t,e,r){let i=false;if(e>t)this.nodesBetween(t,e,(t=>{if(r.isInSet(t.marks))i=true;return!i}));return i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;if(this.content.size)t+="("+this.content.toStringInner()+")";return I(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,r=i.empty,n=0,s=r.childCount){let h=this.contentMatchAt(t).matchFragment(r,n,s);let l=h&&h.matchFragment(this.content,e);if(!l||!l.validEnd)return false;for(let t=n;t<s;t++)if(!this.type.allowsMarks(r.child(t).marks))return false;return true}canReplaceWith(t,e,r,i){if(i&&!this.type.allowsMarks(i))return false;let n=this.contentMatchAt(t).matchType(r);let s=n&&n.matchFragment(this.content,e);return s?s.validEnd:false}canAppend(t){if(t.content.size)return this.canReplace(this.childCount,this.childCount,t.content);else return this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content);let t=l.none;for(let e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!l.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((t=>t.type.name))}`);this.content.forEach((t=>t.check()))}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}if(this.content.size)t.content=this.content.toJSON();if(this.marks.length)t.marks=this.marks.map((t=>t.toJSON()));return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let r=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,r)}let n=i.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,n,r)}}R.prototype.text=undefined;class J extends R{constructor(t,e,r,i){super(t,e,null,i);if(!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);return I(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new J(this.type,this.attrs,this.text,t)}withText(t){if(t==this.text)return this;return new J(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){if(t==0&&e==this.text.length)return this;return this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();t.text=this.text;return t}}function I(t,e){for(let r=t.length-1;r>=0;r--)e=t[r].type.name+"("+e+")";return e}class T{constructor(t){this.validEnd=t;this.next=[];this.wrapCache=[]}static parse(t,e){let r=new A(t,e);if(r.next==null)return T.empty;let i=j(r);if(r.next)r.err("Unexpected trailing text");let n=U(W(i));_(n,r);return n}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,r=t.childCount){let i=this;for(let n=e;i&&n<r;n++)i=i.matchType(t.child(n).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let r=0;r<t.next.length;r++)if(this.next[e].type==t.next[r].type)return true;return false}fillBefore(t,e=false,r=0){let n=[this];function s(h,l){let u=h.matchFragment(t,r);if(u&&(!e||u.validEnd))return i.from(l.map((t=>t.createAndFill())));for(let t=0;t<h.next.length;t++){let{type:e,next:r}=h.next[t];if(!(e.isText||e.hasRequiredAttrs())&&n.indexOf(r)==-1){n.push(r);let t=s(r,l.concat(e));if(t)return t}}return null}return s(this,[])}findWrapping(t){for(let e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];let e=this.computeWrapping(t);this.wrapCache.push(t,e);return e}computeWrapping(t){let e=Object.create(null),r=[{match:this,type:null,via:null}];while(r.length){let i=r.shift(),n=i.match;if(n.matchType(t)){let t=[];for(let e=i;e.type;e=e.via)t.push(e.type);return t.reverse()}for(let t=0;t<n.next.length;t++){let{type:s,next:h}=n.next[t];if(!s.isLeaf&&!s.hasRequiredAttrs()&&!(s.name in e)&&(!i.type||h.validEnd)){r.push({match:s.contentMatch,type:s,via:i});e[s.name]=true}}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function e(r){t.push(r);for(let i=0;i<r.next.length;i++)if(t.indexOf(r.next[i].next)==-1)e(r.next[i].next)}e(this);return t.map(((e,r)=>{let i=r+(e.validEnd?"*":" ")+" ";for(let r=0;r<e.next.length;r++)i+=(r?", ":"")+e.next[r].type.name+"->"+t.indexOf(e.next[r].next);return i})).join("\n")}}T.empty=new T(true);class A{constructor(t,e){this.string=t;this.nodeTypes=e;this.inline=null;this.pos=0;this.tokens=t.split(/\s*(?=\b|\W|$)/);if(this.tokens[this.tokens.length-1]=="")this.tokens.pop();if(this.tokens[0]=="")this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||true)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function j(t){let e=[];do{e.push(C(t))}while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function C(t){let e=[];do{e.push(D(t))}while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function D(t){let e=q(t);for(;;){if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=B(t,e);else break}return e}function $(t){if(/\D/.test(t.next))t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);t.pos++;return e}function B(t,e){let r=$(t),i=r;if(t.eat(",")){if(t.next!="}")i=$(t);else i=-1}if(!t.eat("}"))t.err("Unclosed braced range");return{type:"range",min:r,max:i,expr:e}}function F(t,e){let r=t.nodeTypes,i=r[e];if(i)return[i];let n=[];for(let t in r){let i=r[t];if(i.groups.indexOf(e)>-1)n.push(i)}if(n.length==0)t.err("No node type or group '"+e+"' found");return n}function q(t){if(t.eat("(")){let e=j(t);if(!t.eat(")"))t.err("Missing closing paren");return e}else if(!/\W/.test(t.next)){let e=F(t,t.next).map((e=>{if(t.inline==null)t.inline=e.isInline;else if(t.inline!=e.isInline)t.err("Mixing inline and block content");return{type:"name",value:e}}));t.pos++;return e.length==1?e[0]:{type:"choice",exprs:e}}else{t.err("Unexpected token '"+t.next+"'")}}function W(t){let e=[[]];n(s(t,0),r());return e;function r(){return e.push([])-1}function i(t,r,i){let n={term:i,to:r};e[t].push(n);return n}function n(t,e){t.forEach((t=>t.to=e))}function s(t,e){if(t.type=="choice"){return t.exprs.reduce(((t,r)=>t.concat(s(r,e))),[])}else if(t.type=="seq"){for(let i=0;;i++){let h=s(t.exprs[i],e);if(i==t.exprs.length-1)return h;n(h,e=r())}}else if(t.type=="star"){let h=r();i(e,h);n(s(t.expr,h),h);return[i(h)]}else if(t.type=="plus"){let h=r();n(s(t.expr,e),h);n(s(t.expr,h),h);return[i(h)]}else if(t.type=="opt"){return[i(e)].concat(s(t.expr,e))}else if(t.type=="range"){let h=e;for(let e=0;e<t.min;e++){let e=r();n(s(t.expr,h),e);h=e}if(t.max==-1){n(s(t.expr,h),h)}else{for(let e=t.min;e<t.max;e++){let e=r();i(h,e);n(s(t.expr,h),e);h=e}}return[i(h)]}else if(t.type=="name"){return[i(e,undefined,t.value)]}else{throw new Error("Unknown expr type")}}}function P(t,e){return e-t}function z(t,e){let r=[];i(e);return r.sort(P);function i(e){let n=t[e];if(n.length==1&&!n[0].term)return i(n[0].to);r.push(e);for(let t=0;t<n.length;t++){let{term:e,to:s}=n[t];if(!e&&r.indexOf(s)==-1)i(s)}}}function U(t){let e=Object.create(null);return r(z(t,0));function r(i){let n=[];i.forEach((e=>{t[e].forEach((({term:e,to:r})=>{if(!e)return;let i;for(let t=0;t<n.length;t++)if(n[t][0]==e)i=n[t][1];z(t,r).forEach((t=>{if(!i)n.push([e,i=[]]);if(i.indexOf(t)==-1)i.push(t)}))}))}));let s=e[i.join(",")]=new T(i.indexOf(t.length-1)>-1);for(let t=0;t<n.length;t++){let i=n[t][1].sort(P);s.next.push({type:n[t][0],next:e[i.join(",")]||r(i)})}return s}}function _(t,e){for(let r=0,i=[t];r<i.length;r++){let t=i[r],n=!t.validEnd,s=[];for(let e=0;e<t.next.length;e++){let{type:r,next:h}=t.next[e];s.push(r.name);if(n&&!(r.isText||r.hasRequiredAttrs()))n=false;if(i.indexOf(h)==-1)i.push(h)}if(n)e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function L(t){let e=Object.create(null);for(let r in t){let i=t[r];if(!i.hasDefault)return null;e[r]=i.default}return e}function G(t,e){let r=Object.create(null);for(let i in t){let n=e&&e[i];if(n===undefined){let e=t[i];if(e.hasDefault)n=e.default;else throw new RangeError("No value supplied for attribute "+i)}r[i]=n}return r}function V(t){let e=Object.create(null);if(t)for(let r in t)e[r]=new K(t[r]);return e}class H{constructor(t,e,r){this.name=t;this.schema=e;this.spec=r;this.markSet=null;this.groups=r.group?r.group.split(" "):[];this.attrs=V(r.attrs);this.defaultAttrs=L(this.attrs);this.contentMatch=null;this.inlineContent=null;this.isBlock=!(r.inline||t=="text");this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==T.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return true;return false}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){if(!t&&this.defaultAttrs)return this.defaultAttrs;else return G(this.attrs,t)}create(t=null,e,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new R(this,this.computeAttrs(t),i.from(e),l.setFrom(r))}createChecked(t=null,e,r){e=i.from(e);this.checkContent(e);return new R(this,this.computeAttrs(t),e,l.setFrom(r))}createAndFill(t=null,e,r){t=this.computeAttrs(t);e=i.from(e);if(e.size){let t=this.contentMatch.fillBefore(e);if(!t)return null;e=t.append(e)}let n=this.contentMatch.matchFragment(e);let s=n&&n.fillBefore(i.empty,true);if(!s)return null;return new R(this,t,e.append(s),l.setFrom(r))}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return false;for(let e=0;e<t.childCount;e++)if(!this.allowsMarks(t.child(e).marks))return false;return true}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return true;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return false;return true}allowedMarks(t){if(this.markSet==null)return t;let e;for(let r=0;r<t.length;r++){if(!this.allowsMarkType(t[r].type)){if(!e)e=t.slice(0,r)}else if(e){e.push(t[r])}}return!e?t:e.length?e:l.none}static compile(t,e){let r=Object.create(null);t.forEach(((t,i)=>r[t]=new H(t,e,i)));let i=e.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let t in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}}class K{constructor(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default");this.default=t.default}get isRequired(){return!this.hasDefault}}class Q{constructor(t,e,r,i){this.name=t;this.rank=e;this.schema=r;this.spec=i;this.attrs=V(i.attrs);this.excluded=null;let n=L(this.attrs);this.instance=n?new l(this,n):null}create(t=null){if(!t&&this.instance)return this.instance;return new l(this,G(this.attrs,t))}static compile(t,e){let r=Object.create(null),i=0;t.forEach(((t,n)=>r[t]=new Q(t,i++,e,n)));return r}removeFromSet(t){for(var e=0;e<t.length;e++)if(t[e].type==this){t=t.slice(0,e).concat(t.slice(e+1));e--}return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}excludes(t){return this.excluded.indexOf(t)>-1}}class X{constructor(e){this.cached=Object.create(null);let r=this.spec={};for(let t in e)r[t]=e[t];r.nodes=t.from(e.nodes),r.marks=t.from(e.marks||{}),this.nodes=H.compile(this.spec.nodes,this);this.marks=Q.compile(this.spec.marks,this);let i=Object.create(null);for(let t in this.nodes){if(t in this.marks)throw new RangeError(t+" can not be both a node and a mark");let e=this.nodes[t],r=e.spec.content||"",n=e.spec.marks;e.contentMatch=i[r]||(i[r]=T.parse(r,this.nodes));e.inlineContent=e.contentMatch.inlineContent;e.markSet=n=="_"?null:n?Y(this,n.split(" ")):n==""||!e.inlineContent?[]:null}for(let t in this.marks){let e=this.marks[t],r=e.spec.excludes;e.excluded=r==null?[e]:r==""?[]:Y(this,r.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this);this.markFromJSON=this.markFromJSON.bind(this);this.topNodeType=this.nodes[this.spec.topNode||"doc"];this.cached.wrappings=Object.create(null)}node(t,e=null,r,i){if(typeof t=="string")t=this.nodeType(t);else if(!(t instanceof H))throw new RangeError("Invalid node type: "+t);else if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")");return t.createChecked(e,r,i)}text(t,e){let r=this.nodes.text;return new J(r,r.defaultAttrs,t,l.setFrom(e))}mark(t,e){if(typeof t=="string")t=this.marks[t];return t.create(e)}nodeFromJSON(t){return R.fromJSON(this,t)}markFromJSON(t){return l.fromJSON(this,t)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}}function Y(t,e){let r=[];for(let i=0;i<e.length;i++){let n=e[i],s=t.marks[n],h=s;if(s){r.push(s)}else{for(let e in t.marks){let i=t.marks[e];if(n=="_"||i.spec.group&&i.spec.group.split(" ").indexOf(n)>-1)r.push(h=i)}}if(!h)throw new SyntaxError("Unknown mark type: '"+e[i]+"'")}return r}class Z{constructor(t,e){this.schema=t;this.rules=e;this.tags=[];this.styles=[];e.forEach((t=>{if(t.tag)this.tags.push(t);else if(t.style)this.styles.push(t)}));this.normalizeLists=!this.tags.some((e=>{if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return false;let r=t.nodes[e.node];return r.contentMatch.matchType(r)}))}parse(t,e={}){let r=new ut(this,e,false);r.addAll(t,e.from,e.to);return r.finish()}parseSlice(t,e={}){let r=new ut(this,e,true);r.addAll(t,e.from,e.to);return f.maxOpen(r.finish())}matchTag(t,e,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let r=this.tags[i];if(ot(t,r.tag)&&(r.namespace===undefined||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){let e=r.getAttrs(t);if(e===false)continue;r.attrs=e||undefined}return r}}}matchStyle(t,e,r,i){for(let n=i?this.styles.indexOf(i)+1:0;n<this.styles.length;n++){let i=this.styles[n],s=i.style;if(s.indexOf(t)!=0||i.context&&!r.matchesContext(i.context)||s.length>t.length&&(s.charCodeAt(t.length)!=61||s.slice(t.length+1)!=e))continue;if(i.getAttrs){let t=i.getAttrs(e);if(t===false)continue;i.attrs=t||undefined}return i}}static schemaRules(t){let e=[];function r(t){let r=t.priority==null?50:t.priority,i=0;for(;i<e.length;i++){let t=e[i],n=t.priority==null?50:t.priority;if(n<r)break}e.splice(i,0,t)}for(let e in t.marks){let i=t.marks[e].spec.parseDOM;if(i)i.forEach((t=>{r(t=ct(t));if(!(t.mark||t.ignore||t.clearMark))t.mark=e}))}for(let e in t.nodes){let i=t.nodes[e].spec.parseDOM;if(i)i.forEach((t=>{r(t=ct(t));if(!(t.node||t.ignore||t.mark))t.node=e}))}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new Z(t,Z.schemaRules(t)))}}const tt={address:true,article:true,aside:true,blockquote:true,canvas:true,dd:true,div:true,dl:true,fieldset:true,figcaption:true,figure:true,footer:true,form:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,header:true,hgroup:true,hr:true,li:true,noscript:true,ol:true,output:true,p:true,pre:true,section:true,table:true,tfoot:true,ul:true};const et={head:true,noscript:true,object:true,script:true,style:true,title:true};const rt={ol:true,ul:true};const it=1,nt=2,st=4;function ht(t,e,r){if(e!=null)return(e?it:0)|(e==="full"?nt:0);return t&&t.whitespace=="pre"?it|nt:r&~st}class lt{constructor(t,e,r,i,n,s,h){this.type=t;this.attrs=e;this.marks=r;this.pendingMarks=i;this.solid=n;this.options=h;this.content=[];this.activeMarks=l.none;this.stashMarks=[];this.match=s||(h&st?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(i.from(t));if(e){this.match=this.type.contentMatch.matchFragment(e)}else{let e=this.type.contentMatch,r;if(r=e.findWrapping(t.type)){this.match=e;return r}else{return null}}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&it)){let t=this.content[this.content.length-1],e;if(t&&t.isText&&(e=/[ \t\r\n\u000c]+$/.exec(t.text))){let r=t;if(t.text.length==e[0].length)this.content.pop();else this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-e[0].length))}}let e=i.from(this.content);if(!t&&this.match)e=e.append(this.match.fillBefore(i.empty,true));return this.type?this.type.create(this.attrs,e,this.marks):e}popFromStashMark(t){for(let e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]}applyPending(t){for(let e=0,r=this.pendingMarks;e<r.length;e++){let i=r[e];if((this.type?this.type.allowsMarkType(i.type):pt(i.type,t))&&!i.isInSet(this.activeMarks)){this.activeMarks=i.addToSet(this.activeMarks);this.pendingMarks=i.removeFromSet(this.pendingMarks)}}}inlineContext(t){if(this.type)return this.type.inlineContent;if(this.content.length)return this.content[0].isInline;return t.parentNode&&!tt.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class ut{constructor(t,e,r){this.parser=t;this.options=e;this.isOpen=r;this.open=0;let i=e.topNode,n;let s=ht(null,e.preserveWhitespace,0)|(r?st:0);if(i)n=new lt(i.type,i.attrs,l.none,l.none,true,e.topMatch||i.type.contentMatch,s);else if(r)n=new lt(null,null,l.none,l.none,true,null,s);else n=new lt(t.schema.topNodeType,null,l.none,l.none,true,null,s);this.nodes=[n];this.find=e.findPositions;this.needsBlock=false}get top(){return this.nodes[this.open]}addDOM(t){if(t.nodeType==3)this.addTextNode(t);else if(t.nodeType==1)this.addElement(t)}withStyleRules(t,e){let r=t.getAttribute("style");if(!r)return e();let i=this.readStyles(at(r));if(!i)return;let[n,s]=i,h=this.top;for(let t=0;t<s.length;t++)this.removePendingMark(s[t],h);for(let t=0;t<n.length;t++)this.addPendingMark(n[t]);e();for(let t=0;t<n.length;t++)this.removePendingMark(n[t],h);for(let t=0;t<s.length;t++)this.addPendingMark(s[t])}addTextNode(t){let e=t.nodeValue;let r=this.top;if(r.options&nt||r.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(!(r.options&it)){e=e.replace(/[ \t\r\n\u000c]+/g," ");if(/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){let i=r.content[r.content.length-1];let n=t.previousSibling;if(!i||n&&n.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))e=e.slice(1)}}else if(!(r.options&nt)){e=e.replace(/\r?\n|\r/g," ")}else{e=e.replace(/\r\n?/g,"\n")}if(e)this.insertNode(this.parser.schema.text(e));this.findInText(t)}else{this.findInside(t)}}addElement(t,e){let r=t.nodeName.toLowerCase(),i;if(rt.hasOwnProperty(r)&&this.parser.normalizeLists)ft(t);let n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(i=this.parser.matchTag(t,this,e));if(n?n.ignore:et.hasOwnProperty(r)){this.findInside(t);this.ignoreFallback(t)}else if(!n||n.skip||n.closeParent){if(n&&n.closeParent)this.open=Math.max(0,this.open-1);else if(n&&n.skip.nodeType)t=n.skip;let e,i=this.top,s=this.needsBlock;if(tt.hasOwnProperty(r)){if(i.content.length&&i.content[0].isInline&&this.open){this.open--;i=this.top}e=true;if(!i.type)this.needsBlock=true}else if(!t.firstChild){this.leafFallback(t);return}if(n&&n.skip)this.addAll(t);else this.withStyleRules(t,(()=>this.addAll(t)));if(e)this.sync(i);this.needsBlock=s}else{this.withStyleRules(t,(()=>{this.addElementByRule(t,n,n.consuming===false?i:undefined)}))}}leafFallback(t){if(t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent)this.addTextNode(t.ownerDocument.createTextNode("\n"))}ignoreFallback(t){if(t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent))this.findPlace(this.parser.schema.text("-"))}readStyles(t){let e=l.none,r=l.none;for(let i=0;i<t.length;i+=2){for(let n=undefined;;){let s=this.parser.matchStyle(t[i],t[i+1],this,n);if(!s)break;if(s.ignore)return null;if(s.clearMark){this.top.pendingMarks.concat(this.top.activeMarks).forEach((t=>{if(s.clearMark(t))r=t.addToSet(r)}))}else{e=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(e)}if(s.consuming===false)n=s;else break}}return[e,r]}addElementByRule(t,e,r){let i,n,s;if(e.node){n=this.parser.schema.nodes[e.node];if(!n.isLeaf){i=this.enter(n,e.attrs||null,e.preserveWhitespace)}else if(!this.insertNode(n.create(e.attrs))){this.leafFallback(t)}}else{let t=this.parser.schema.marks[e.mark];s=t.create(e.attrs);this.addPendingMark(s)}let h=this.top;if(n&&n.isLeaf){this.findInside(t)}else if(r){this.addElement(t,r)}else if(e.getContent){this.findInside(t);e.getContent(t,this.parser.schema).forEach((t=>this.insertNode(t)))}else{let r=t;if(typeof e.contentElement=="string")r=t.querySelector(e.contentElement);else if(typeof e.contentElement=="function")r=e.contentElement(t);else if(e.contentElement)r=e.contentElement;this.findAround(t,r,true);this.addAll(r)}if(i&&this.sync(h))this.open--;if(s)this.removePendingMark(s,h)}addAll(t,e,r){let i=e||0;for(let n=e?t.childNodes[e]:t.firstChild,s=r==null?null:t.childNodes[r];n!=s;n=n.nextSibling,++i){this.findAtPoint(t,i);this.addDOM(n)}this.findAtPoint(t,i)}findPlace(t){let e,r;for(let i=this.open;i>=0;i--){let n=this.nodes[i];let s=n.findWrapping(t);if(s&&(!e||e.length>s.length)){e=s;r=n;if(!s.length)break}if(n.solid)break}if(!e)return false;this.sync(r);for(let t=0;t<e.length;t++)this.enterInner(e[t],null,false);return true}insertNode(t){if(t.isInline&&this.needsBlock&&!this.top.type){let t=this.textblockFromContext();if(t)this.enterInner(t)}if(this.findPlace(t)){this.closeExtra();let e=this.top;e.applyPending(t.type);if(e.match)e.match=e.match.matchType(t.type);let r=e.activeMarks;for(let i=0;i<t.marks.length;i++)if(!e.type||e.type.allowsMarkType(t.marks[i].type))r=t.marks[i].addToSet(r);e.content.push(t.mark(r));return true}return false}enter(t,e,r){let i=this.findPlace(t.create(e));if(i)this.enterInner(t,e,true,r);return i}enterInner(t,e=null,r=false,i){this.closeExtra();let n=this.top;n.applyPending(t);n.match=n.match&&n.match.matchType(t);let s=ht(t,i,n.options);if(n.options&st&&n.content.length==0)s|=st;this.nodes.push(new lt(t,e,n.activeMarks,n.pendingMarks,r,null,s));this.open++}closeExtra(t=false){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){this.open=0;this.closeExtra(this.isOpen);return this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(t){for(let e=this.open;e>=0;e--)if(this.nodes[e]==t){this.open=e;return true}return false}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let r=this.nodes[e].content;for(let e=r.length-1;e>=0;e--)t+=r[e].nodeSize;if(e)t++}return t}findAtPoint(t,e){if(this.find)for(let r=0;r<this.find.length;r++){if(this.find[r].node==t&&this.find[r].offset==e)this.find[r].pos=this.currentPos}}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++){if(this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node))this.find[e].pos=this.currentPos}}findAround(t,e,r){if(t!=e&&this.find)for(let i=0;i<this.find.length;i++){if(this.find[i].pos==null&&t.nodeType==1&&t.contains(this.find[i].node)){let t=e.compareDocumentPosition(this.find[i].node);if(t&(r?2:4))this.find[i].pos=this.currentPos}}}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++){if(this.find[e].node==t)this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset)}}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/");let r=this.options.context;let i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type);let n=-(r?r.depth+1:0)+(i?0:1);let s=(t,h)=>{for(;t>=0;t--){let l=e[t];if(l==""){if(t==e.length-1||t==0)continue;for(;h>=n;h--)if(s(t-1,h))return true;return false}else{let t=h>0||h==0&&i?this.nodes[h].type:r&&h>=n?r.node(h-n).type:null;if(!t||t.name!=l&&t.groups.indexOf(l)==-1)return false;h--}}return true};return s(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let r=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let t in this.parser.schema.nodes){let e=this.parser.schema.nodes[t];if(e.isTextblock&&e.defaultAttrs)return e}}addPendingMark(t){let e=dt(t,this.top.pendingMarks);if(e)this.top.stashMarks.push(e);this.top.pendingMarks=t.addToSet(this.top.pendingMarks)}removePendingMark(t,e){for(let r=this.open;r>=0;r--){let i=this.nodes[r];let n=i.pendingMarks.lastIndexOf(t);if(n>-1){i.pendingMarks=t.removeFromSet(i.pendingMarks)}else{i.activeMarks=t.removeFromSet(i.activeMarks);let e=i.popFromStashMark(t);if(e&&i.type&&i.type.allowsMarkType(e.type))i.activeMarks=e.addToSet(i.activeMarks)}if(i==e)break}}}function ft(t){for(let e=t.firstChild,r=null;e;e=e.nextSibling){let t=e.nodeType==1?e.nodeName.toLowerCase():null;if(t&&rt.hasOwnProperty(t)&&r){r.appendChild(e);e=r}else if(t=="li"){r=e}else if(t){r=null}}}function ot(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function at(t){let e=/\s*([\w-]+)\s*:\s*([^;]+)/g,r,i=[];while(r=e.exec(t))i.push(r[1],r[2].trim());return i}function ct(t){let e={};for(let r in t)e[r]=t[r];return e}function pt(t,e){let r=e.schema.nodes;for(let i in r){let n=r[i];if(!n.allowsMarkType(t))continue;let s=[],h=t=>{s.push(t);for(let r=0;r<t.edgeCount;r++){let{type:i,next:n}=t.edge(r);if(i==e)return true;if(s.indexOf(n)<0&&h(n))return true}};if(h(n.contentMatch))return true}}function dt(t,e){for(let r=0;r<e.length;r++){if(t.eq(e[r]))return e[r]}}class wt{constructor(t,e){this.nodes=t;this.marks=e}serializeFragment(t,e={},r){if(!r)r=gt(e).createDocumentFragment();let i=r,n=[];t.forEach((t=>{if(n.length||t.marks.length){let r=0,s=0;while(r<n.length&&s<t.marks.length){let e=t.marks[s];if(!this.marks[e.type.name]){s++;continue}if(!e.eq(n[r][0])||e.type.spec.spanning===false)break;r++;s++}while(r<n.length)i=n.pop()[1];while(s<t.marks.length){let r=t.marks[s++];let h=this.serializeMark(r,t.isInline,e);if(h){n.push([r,i]);i.appendChild(h.dom);i=h.contentDOM||h.dom}}}i.appendChild(this.serializeNodeInner(t,e))}));return r}serializeNodeInner(t,e){let{dom:r,contentDOM:i}=wt.renderSpec(gt(e),this.nodes[t.type.name](t));if(i){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,i)}return r}serializeNode(t,e={}){let r=this.serializeNodeInner(t,e);for(let i=t.marks.length-1;i>=0;i--){let n=this.serializeMark(t.marks[i],t.isInline,e);if(n){(n.contentDOM||n.dom).appendChild(r);r=n.dom}}return r}serializeMark(t,e,r={}){let i=this.marks[t.type.name];return i&&wt.renderSpec(gt(r),i(t,e))}static renderSpec(t,e,r=null){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],n=i.indexOf(" ");if(n>0){r=i.slice(0,n);i=i.slice(n+1)}let s;let h=r?t.createElementNS(r,i):t.createElement(i);let l=e[1],u=1;if(l&&typeof l=="object"&&l.nodeType==null&&!Array.isArray(l)){u=2;for(let t in l)if(l[t]!=null){let e=t.indexOf(" ");if(e>0)h.setAttributeNS(t.slice(0,e),t.slice(e+1),l[t]);else h.setAttribute(t,l[t])}}for(let i=u;i<e.length;i++){let n=e[i];if(n===0){if(i<e.length-1||i>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:h,contentDOM:h}}else{let{dom:e,contentDOM:i}=wt.renderSpec(t,n,r);h.appendChild(e);if(i){if(s)throw new RangeError("Multiple content holes");s=i}}}return{dom:h,contentDOM:s}}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new wt(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=mt(t.nodes);if(!e.text)e.text=t=>t.text;return e}static marksFromSchema(t){return mt(t.marks)}}function mt(t){let e={};for(let r in t){let i=t[r].spec.toDOM;if(i)e[r]=i}return e}function gt(t){return t.document||window.document}const yt=65535;const St=Math.pow(2,16);function bt(t,e){return t+e*St}function kt(t){return t&yt}function vt(t){return(t-(t&yt))/St}const xt=1,Nt=2,Ot=4,Et=8;class Mt{constructor(t,e,r){this.pos=t;this.delInfo=e;this.recover=r}get deleted(){return(this.delInfo&Et)>0}get deletedBefore(){return(this.delInfo&(xt|Ot))>0}get deletedAfter(){return(this.delInfo&(Nt|Ot))>0}get deletedAcross(){return(this.delInfo&Ot)>0}}class Rt{constructor(t,e=false){this.ranges=t;this.inverted=e;if(!t.length&&Rt.empty)return Rt.empty}recover(t){let e=0,r=kt(t);if(!this.inverted)for(let t=0;t<r;t++)e+=this.ranges[t*3+2]-this.ranges[t*3+1];return this.ranges[r*3]+e+vt(t)}mapResult(t,e=1){return this._map(t,e,false)}map(t,e=1){return this._map(t,e,true)}_map(t,e,r){let i=0,n=this.inverted?2:1,s=this.inverted?1:2;for(let h=0;h<this.ranges.length;h+=3){let l=this.ranges[h]-(this.inverted?i:0);if(l>t)break;let u=this.ranges[h+n],f=this.ranges[h+s],o=l+u;if(t<=o){let n=!u?e:t==l?-1:t==o?1:e;let s=l+i+(n<0?0:f);if(r)return s;let a=t==(e<0?l:o)?null:bt(h/3,t-l);let c=t==l?Nt:t==o?xt:Ot;if(e<0?t!=l:t!=o)c|=Et;return new Mt(s,c,a)}i+=f-u}return r?t+i:new Mt(t+i,0,null)}touches(t,e){let r=0,i=kt(e);let n=this.inverted?2:1,s=this.inverted?1:2;for(let e=0;e<this.ranges.length;e+=3){let h=this.ranges[e]-(this.inverted?r:0);if(h>t)break;let l=this.ranges[e+n],u=h+l;if(t<=u&&e==i*3)return true;r+=this.ranges[e+s]-l}return false}forEach(t){let e=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,n=0;i<this.ranges.length;i+=3){let s=this.ranges[i],h=s-(this.inverted?n:0),l=s+(this.inverted?0:n);let u=this.ranges[i+e],f=this.ranges[i+r];t(h,h+u,l,l+f);n+=f-u}}invert(){return new Rt(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?Rt.empty:new Rt(t<0?[0,-t,0]:[0,0,t])}}Rt.empty=new Rt([]);class Jt{constructor(t=[],e,r=0,i=t.length){this.maps=t;this.mirror=e;this.from=r;this.to=i}slice(t=0,e=this.maps.length){return new Jt(this.maps,this.mirror,t,e)}copy(){return new Jt(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(t,e){this.to=this.maps.push(t);if(e!=null)this.setMirror(this.maps.length-1,e)}appendMapping(t){for(let e=0,r=this.maps.length;e<t.maps.length;e++){let i=t.getMirror(e);this.appendMap(t.maps[e],i!=null&&i<e?r+i:undefined)}}getMirror(t){if(this.mirror)for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}setMirror(t,e){if(!this.mirror)this.mirror=[];this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,r=this.maps.length+t.maps.length;e>=0;e--){let i=t.getMirror(e);this.appendMap(t.maps[e].invert(),i!=null&&i>e?r-i-1:undefined)}}invert(){let t=new Jt;t.appendMappingInverted(this);return t}map(t,e=1){if(this.mirror)return this._map(t,e,true);for(let r=this.from;r<this.to;r++)t=this.maps[r].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,false)}_map(t,e,r){let i=0;for(let r=this.from;r<this.to;r++){let n=this.maps[r],s=n.mapResult(t,e);if(s.recover!=null){let e=this.getMirror(r);if(e!=null&&e>r&&e<this.to){r=e;t=this.maps[e].recover(s.recover);continue}}i|=s.delInfo;t=s.pos}return r?t:new Mt(t,i,null)}}const It=Object.create(null);class Tt{getMap(){return Rt.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=It[e.stepType];if(!r)throw new RangeError(`No step type ${e.stepType} defined`);return r.fromJSON(t,e)}static jsonID(t,e){if(t in It)throw new RangeError("Duplicate use of step JSON ID "+t);It[t]=e;e.prototype.jsonID=t;return e}}class At{constructor(t,e){this.doc=t;this.failed=e}static ok(t){return new At(t,null)}static fail(t){return new At(null,t)}static fromReplace(t,e,r,i){try{return At.ok(t.replace(e,r,i))}catch(t){if(t instanceof u)return At.fail(t.message);throw t}}}function jt(t,e,r){let n=[];for(let i=0;i<t.childCount;i++){let s=t.child(i);if(s.content.size)s=s.copy(jt(s.content,e,s));if(s.isInline)s=e(s,r,i);n.push(s)}return i.fromArray(n)}class Ct extends Tt{constructor(t,e,r){super();this.from=t;this.to=e;this.mark=r}apply(t){let e=t.slice(this.from,this.to),r=t.resolve(this.from);let i=r.node(r.sharedDepth(this.to));let n=new f(jt(e.content,((t,e)=>{if(!t.isAtom||!e.type.allowsMarkType(this.mark.type))return t;return t.mark(this.mark.addToSet(t.marks))}),i),e.openStart,e.openEnd);return At.fromReplace(t,this.from,this.to,n)}invert(){return new Dt(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);if(e.deleted&&r.deleted||e.pos>=r.pos)return null;return new Ct(e.pos,r.pos,this.mark)}merge(t){if(t instanceof Ct&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new Ct(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark);return null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ct(e.from,e.to,t.markFromJSON(e.mark))}}Tt.jsonID("addMark",Ct);class Dt extends Tt{constructor(t,e,r){super();this.from=t;this.to=e;this.mark=r}apply(t){let e=t.slice(this.from,this.to);let r=new f(jt(e.content,(t=>t.mark(this.mark.removeFromSet(t.marks))),t),e.openStart,e.openEnd);return At.fromReplace(t,this.from,this.to,r)}invert(){return new Ct(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);if(e.deleted&&r.deleted||e.pos>=r.pos)return null;return new Dt(e.pos,r.pos,this.mark)}merge(t){if(t instanceof Dt&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new Dt(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark);return null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Dt(e.from,e.to,t.markFromJSON(e.mark))}}Tt.jsonID("removeMark",Dt);class $t extends Tt{constructor(t,e){super();this.pos=t;this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return At.fail("No node at mark step's position");let r=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return At.fromReplace(t,this.pos,this.pos+1,new f(i.from(r),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let t=this.mark.addToSet(e.marks);if(t.length==e.marks.length){for(let r=0;r<e.marks.length;r++)if(!e.marks[r].isInSet(t))return new $t(this.pos,e.marks[r]);return new $t(this.pos,this.mark)}}return new Bt(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new $t(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new $t(e.pos,t.markFromJSON(e.mark))}}Tt.jsonID("addNodeMark",$t);class Bt extends Tt{constructor(t,e){super();this.pos=t;this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return At.fail("No node at mark step's position");let r=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return At.fromReplace(t,this.pos,this.pos+1,new f(i.from(r),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(!e||!this.mark.isInSet(e.marks))return this;return new $t(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new Bt(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Bt(e.pos,t.markFromJSON(e.mark))}}Tt.jsonID("removeNodeMark",Bt);class Ft extends Tt{constructor(t,e,r,i=false){super();this.from=t;this.to=e;this.slice=r;this.structure=i}apply(t){if(this.structure&&Wt(t,this.from,this.to))return At.fail("Structure replace would overwrite content");return At.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new Rt([this.from,this.to-this.from,this.slice.size])}invert(t){return new Ft(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);if(e.deletedAcross&&r.deletedAcross)return null;return new Ft(e.pos,Math.max(e.pos,r.pos),this.slice)}merge(t){if(!(t instanceof Ft)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let e=this.slice.size+t.slice.size==0?f.empty:new f(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new Ft(this.from,this.to+(t.to-t.from),e,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let e=this.slice.size+t.slice.size==0?f.empty:new f(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new Ft(t.from,this.to,e,this.structure)}else{return null}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};if(this.slice.size)t.slice=this.slice.toJSON();if(this.structure)t.structure=true;return t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Ft(e.from,e.to,f.fromJSON(t,e.slice),!!e.structure)}}Tt.jsonID("replace",Ft);class qt extends Tt{constructor(t,e,r,i,n,s,h=false){super();this.from=t;this.to=e;this.gapFrom=r;this.gapTo=i;this.slice=n;this.insert=s;this.structure=h}apply(t){if(this.structure&&(Wt(t,this.from,this.gapFrom)||Wt(t,this.gapTo,this.to)))return At.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return At.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,e.content);if(!r)return At.fail("Content does not fit in gap");return At.fromReplace(t,this.from,this.to,r)}getMap(){return new Rt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new qt(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);let i=t.map(this.gapFrom,-1),n=t.map(this.gapTo,1);if(e.deletedAcross&&r.deletedAcross||i<e.pos||n>r.pos)return null;return new qt(e.pos,r.pos,i,n,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};if(this.slice.size)t.slice=this.slice.toJSON();if(this.structure)t.structure=true;return t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number"||typeof e.gapFrom!="number"||typeof e.gapTo!="number"||typeof e.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new qt(e.from,e.to,e.gapFrom,e.gapTo,f.fromJSON(t,e.slice),e.insert,!!e.structure)}}Tt.jsonID("replaceAround",qt);function Wt(t,e,r){let i=t.resolve(e),n=r-e,s=i.depth;while(n>0&&s>0&&i.indexAfter(s)==i.node(s).childCount){s--;n--}if(n>0){let t=i.node(s).maybeChild(i.indexAfter(s));while(n>0){if(!t||t.isLeaf)return true;t=t.firstChild;n--}}return false}function Pt(t,e,r,i){let n=[],s=[];let h,l;t.doc.nodesBetween(e,r,((t,u,f)=>{if(!t.isInline)return;let o=t.marks;if(!i.isInSet(o)&&f.type.allowsMarkType(i.type)){let f=Math.max(u,e),a=Math.min(u+t.nodeSize,r);let c=i.addToSet(o);for(let t=0;t<o.length;t++){if(!o[t].isInSet(c)){if(h&&h.to==f&&h.mark.eq(o[t]))h.to=a;else n.push(h=new Dt(f,a,o[t]))}}if(l&&l.to==f)l.to=a;else s.push(l=new Ct(f,a,i))}}));n.forEach((e=>t.step(e)));s.forEach((e=>t.step(e)))}function zt(t,e,r,i){let n=[],s=0;t.doc.nodesBetween(e,r,((t,h)=>{if(!t.isInline)return;s++;let l=null;if(i instanceof Q){let e=t.marks,r;while(r=i.isInSet(e)){(l||(l=[])).push(r);e=r.removeFromSet(e)}}else if(i){if(i.isInSet(t.marks))l=[i]}else{l=t.marks}if(l&&l.length){let i=Math.min(h+t.nodeSize,r);for(let t=0;t<l.length;t++){let r=l[t],u;for(let t=0;t<n.length;t++){let e=n[t];if(e.step==s-1&&r.eq(n[t].style))u=e}if(u){u.to=i;u.step=s}else{n.push({style:r,from:Math.max(h,e),to:i,step:s})}}}}));n.forEach((e=>t.step(new Dt(e.from,e.to,e.style))))}function Ut(t,e,r,n=r.contentMatch){let s=t.doc.nodeAt(e);let h=[],l=e+1;for(let e=0;e<s.childCount;e++){let u=s.child(e),o=l+u.nodeSize;let a=n.matchType(u.type);if(!a){h.push(new Ft(l,o,f.empty))}else{n=a;for(let e=0;e<u.marks.length;e++)if(!r.allowsMarkType(u.marks[e].type))t.step(new Dt(l,o,u.marks[e]));if(u.isText&&!r.spec.code){let t,e=/\r?\n|\r/g,n;while(t=e.exec(u.text)){if(!n)n=new f(i.from(r.schema.text(" ",r.allowedMarks(u.marks))),0,0);h.push(new Ft(l+t.index,l+t.index+t[0].length,n))}}}l=o}if(!n.validEnd){let e=n.fillBefore(i.empty,true);t.replace(l,l,new f(e,0,0))}for(let e=h.length-1;e>=0;e--)t.step(h[e])}function _t(t,e,r){return(e==0||t.canReplace(e,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function Lt(t){let e=t.parent;let r=e.content.cutByIndex(t.startIndex,t.endIndex);for(let e=t.depth;;--e){let i=t.$from.node(e);let n=t.$from.index(e),s=t.$to.indexAfter(e);if(e<t.depth&&i.canReplace(n,s,r))return e;if(e==0||i.type.spec.isolating||!_t(i,n,s))break}return null}function Gt(t,e,r){let{$from:n,$to:s,depth:h}=e;let l=n.before(h+1),u=s.after(h+1);let o=l,a=u;let c=i.empty,p=0;for(let t=h,e=false;t>r;t--)if(e||n.index(t)>0){e=true;c=i.from(n.node(t).copy(c));p++}else{o--}let d=i.empty,w=0;for(let t=h,e=false;t>r;t--)if(e||s.after(t+1)<s.end(t)){e=true;d=i.from(s.node(t).copy(d));w++}else{a++}t.step(new qt(o,a,l,u,new f(c.append(d),p,w),c.size-p,true))}function Vt(t,e,r=null,i=t){let n=Kt(t,e);let s=n&&Qt(i,e);if(!s)return null;return n.map(Ht).concat({type:e,attrs:r}).concat(s.map(Ht))}function Ht(t){return{type:t,attrs:null}}function Kt(t,e){let{parent:r,startIndex:i,endIndex:n}=t;let s=r.contentMatchAt(i).findWrapping(e);if(!s)return null;let h=s.length?s[0]:e;return r.canReplaceWith(i,n,h)?s:null}function Qt(t,e){let{parent:r,startIndex:i,endIndex:n}=t;let s=r.child(i);let h=e.contentMatch.findWrapping(s.type);if(!h)return null;let l=h.length?h[h.length-1]:e;let u=l.contentMatch;for(let t=i;u&&t<n;t++)u=u.matchType(r.child(t).type);if(!u||!u.validEnd)return null;return h}function Xt(t,e,r){let n=i.empty;for(let t=r.length-1;t>=0;t--){if(n.size){let e=r[t].type.contentMatch.matchFragment(n);if(!e||!e.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=i.from(r[t].type.create(r[t].attrs,n))}let s=e.start,h=e.end;t.step(new qt(s,h,s,h,new f(n,0,0),r.length,true))}function Yt(t,e,r,n,s){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let h=t.steps.length;t.doc.nodesBetween(e,r,((e,r)=>{if(e.isTextblock&&!e.hasMarkup(n,s)&&Zt(t.doc,t.mapping.slice(h).map(r),n)){t.clearIncompatible(t.mapping.slice(h).map(r,1),n);let l=t.mapping.slice(h);let u=l.map(r,1),o=l.map(r+e.nodeSize,1);t.step(new qt(u,o,u+1,o-1,new f(i.from(n.create(s,null,e.marks)),0,0),1,true));return false}}))}function Zt(t,e,r){let i=t.resolve(e),n=i.index();return i.parent.canReplaceWith(n,n+1,r)}function te(t,e,r,n,s){let h=t.doc.nodeAt(e);if(!h)throw new RangeError("No node at given position");if(!r)r=h.type;let l=r.create(n,null,s||h.marks);if(h.isLeaf)return t.replaceWith(e,e+h.nodeSize,l);if(!r.validContent(h.content))throw new RangeError("Invalid content for node type "+r.name);t.step(new qt(e,e+h.nodeSize,e+1,e+h.nodeSize-1,new f(i.from(l),0,0),1,true))}function ee(t,e,r=1,i){let n=t.resolve(e),s=n.depth-r;let h=i&&i[i.length-1]||n.parent;if(s<0||n.parent.type.spec.isolating||!n.parent.canReplace(n.index(),n.parent.childCount)||!h.type.validContent(n.parent.content.cutByIndex(n.index(),n.parent.childCount)))return false;for(let t=n.depth-1,e=r-2;t>s;t--,e--){let r=n.node(t),s=n.index(t);if(r.type.spec.isolating)return false;let h=r.content.cutByIndex(s,r.childCount);let l=i&&i[e+1];if(l)h=h.replaceChild(0,l.type.create(l.attrs));let u=i&&i[e]||r;if(!r.canReplace(s+1,r.childCount)||!u.type.validContent(h))return false}let l=n.indexAfter(s);let u=i&&i[0];return n.node(s).canReplaceWith(l,l,u?u.type:n.node(s+1).type)}function re(t,e,r=1,n){let s=t.doc.resolve(e),h=i.empty,l=i.empty;for(let t=s.depth,e=s.depth-r,u=r-1;t>e;t--,u--){h=i.from(s.node(t).copy(h));let e=n&&n[u];l=i.from(e?e.type.create(e.attrs,l):s.node(t).copy(l))}t.step(new Ft(e,e,new f(h.append(l),r,r),true))}function ie(t,e){let r=t.resolve(e),i=r.index();return ne(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(i,i+1)}function ne(t,e){return!!(t&&e&&!t.isLeaf&&t.canAppend(e))}function se(t,e,r=-1){let i=t.resolve(e);for(let t=i.depth;;t--){let n,s,h=i.index(t);if(t==i.depth){n=i.nodeBefore;s=i.nodeAfter}else if(r>0){n=i.node(t+1);h++;s=i.node(t).maybeChild(h)}else{n=i.node(t).maybeChild(h-1);s=i.node(t+1)}if(n&&!n.isTextblock&&ne(n,s)&&i.node(t).canReplace(h,h+1))return e;if(t==0)break;e=r<0?i.before(t):i.after(t)}}function he(t,e,r){let i=new Ft(e-r,e+r,f.empty,true);t.step(i)}function le(t,e,r){let i=t.resolve(e);if(i.parent.canReplaceWith(i.index(),i.index(),r))return e;if(i.parentOffset==0)for(let t=i.depth-1;t>=0;t--){let e=i.index(t);if(i.node(t).canReplaceWith(e,e,r))return i.before(t+1);if(e>0)return null}if(i.parentOffset==i.parent.content.size)for(let t=i.depth-1;t>=0;t--){let e=i.indexAfter(t);if(i.node(t).canReplaceWith(e,e,r))return i.after(t+1);if(e<i.node(t).childCount)return null}return null}function ue(t,e,r){let i=t.resolve(e);if(!r.content.size)return e;let n=r.content;for(let t=0;t<r.openStart;t++)n=n.firstChild.content;for(let t=1;t<=(r.openStart==0&&r.size?2:1);t++){for(let e=i.depth;e>=0;e--){let r=e==i.depth?0:i.pos<=(i.start(e+1)+i.end(e+1))/2?-1:1;let s=i.index(e)+(r>0?1:0);let h=i.node(e),l=false;if(t==1){l=h.canReplace(s,s,n)}else{let t=h.contentMatchAt(s).findWrapping(n.firstChild.type);l=t&&h.canReplaceWith(s,s,t[0])}if(l)return r==0?i.pos:r<0?i.before(e+1):i.after(e+1)}}return null}function fe(t,e,r=e,i=f.empty){if(e==r&&!i.size)return null;let n=t.resolve(e),s=t.resolve(r);if(oe(n,s,i))return new Ft(e,r,i);return new ae(n,s,i).fit()}function oe(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}class ae{constructor(t,e,r){this.$from=t;this.$to=e;this.unplaced=r;this.frontier=[];this.placed=i.empty;for(let e=0;e<=t.depth;e++){let r=t.node(e);this.frontier.push({type:r.type,match:r.contentMatchAt(t.indexAfter(e))})}for(let e=t.depth;e>0;e--)this.placed=i.from(t.node(e).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){while(this.unplaced.size){let t=this.findFittable();if(t)this.placeNodes(t);else this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth;let r=this.$from,i=this.close(t<0?this.$to:r.doc.resolve(t));if(!i)return null;let n=this.placed,s=r.depth,h=i.depth;while(s&&h&&n.childCount==1){n=n.firstChild.content;s--;h--}let l=new f(n,s,h);if(t>-1)return new qt(r.pos,t,this.$to.pos,this.$to.end(),l,e);if(l.size||r.pos!=this.$to.pos)return new Ft(r.pos,i.pos,l);return null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,r=0,i=this.unplaced.openEnd;r<t;r++){let n=e.firstChild;if(e.childCount>1)i=0;if(n.type.spec.isolating&&i<=r){t=r;break}e=n.content}for(let e=1;e<=2;e++){for(let r=e==1?t:this.unplaced.openStart;r>=0;r--){let t,n=null;if(r){n=de(this.unplaced.content,r-1).firstChild;t=n.content}else{t=this.unplaced.content}let s=t.firstChild;for(let t=this.depth;t>=0;t--){let{type:h,match:l}=this.frontier[t],u,f=null;if(e==1&&(s?l.matchType(s.type)||(f=l.fillBefore(i.from(s),false)):n&&h.compatibleContent(n.type)))return{sliceDepth:r,frontierDepth:t,parent:n,inject:f};else if(e==2&&s&&(u=l.findWrapping(s.type)))return{sliceDepth:r,frontierDepth:t,parent:n,wrap:u};if(n&&l.matchType(n.type))break}}}}openMore(){let{content:t,openStart:e,openEnd:r}=this.unplaced;let i=de(t,e);if(!i.childCount||i.firstChild.isLeaf)return false;this.unplaced=new f(t,e+1,Math.max(r,i.size+e>=t.size-r?e+1:0));return true}dropNode(){let{content:t,openStart:e,openEnd:r}=this.unplaced;let i=de(t,e);if(i.childCount<=1&&e>0){let n=t.size-e<=e+i.size;this.unplaced=new f(ce(t,e-1,1),e-1,n?e-1:r)}else{this.unplaced=new f(ce(t,e,1),e,r)}}placeNodes({sliceDepth:t,frontierDepth:e,parent:r,inject:n,wrap:s}){while(this.depth>e)this.closeFrontierNode();if(s)for(let t=0;t<s.length;t++)this.openFrontierNode(s[t]);let h=this.unplaced,l=r?r.content:h.content;let u=h.openStart-t;let o=0,a=[];let{match:c,type:p}=this.frontier[e];if(n){for(let t=0;t<n.childCount;t++)a.push(n.child(t));c=c.matchFragment(n)}let d=l.size+t-(h.content.size-h.openEnd);while(o<l.childCount){let t=l.child(o),e=c.matchType(t.type);if(!e)break;o++;if(o>1||u==0||t.content.size){c=e;a.push(we(t.mark(p.allowedMarks(t.marks)),o==1?u:0,o==l.childCount?d:-1))}}let w=o==l.childCount;if(!w)d=-1;this.placed=pe(this.placed,e,i.from(a));this.frontier[e].match=c;if(w&&d<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1)this.closeFrontierNode();for(let t=0,e=l;t<d;t++){let t=e.lastChild;this.frontier.push({type:t.type,match:t.contentMatchAt(t.childCount)});e=t.content}this.unplaced=!w?new f(ce(h.content,t,o),h.openStart,h.openEnd):t==0?f.empty:new f(ce(h.content,t-1,1),t-1,d<0?h.openEnd:t-1)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],e;if(!t.type.isTextblock||!me(this.$to,this.$to.depth,t.type,t.match,false)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);while(r>1&&i==this.$to.end(--r))++i;return i}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:r,type:i}=this.frontier[e];let n=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1));let s=me(t,e,i,r,n);if(!s)continue;for(let r=e-1;r>=0;r--){let{match:e,type:i}=this.frontier[r];let n=me(t,r,i,e,true);if(!n||n.childCount)continue t}return{depth:e,fit:s,move:n?t.doc.resolve(t.after(e+1)):t}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;while(this.depth>e.depth)this.closeFrontierNode();if(e.fit.childCount)this.placed=pe(this.placed,e.depth,e.fit);t=e.move;for(let r=e.depth+1;r<=t.depth;r++){let e=t.node(r),i=e.type.contentMatch.fillBefore(e.content,true,t.index(r));this.openFrontierNode(e.type,e.attrs,i)}return t}openFrontierNode(t,e=null,r){let n=this.frontier[this.depth];n.match=n.match.matchType(t);this.placed=pe(this.placed,this.depth,i.from(t.create(e,r)));this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let t=this.frontier.pop();let e=t.match.fillBefore(i.empty,true);if(e.childCount)this.placed=pe(this.placed,this.frontier.length,e)}}function ce(t,e,r){if(e==0)return t.cutByIndex(r,t.childCount);return t.replaceChild(0,t.firstChild.copy(ce(t.firstChild.content,e-1,r)))}function pe(t,e,r){if(e==0)return t.append(r);return t.replaceChild(t.childCount-1,t.lastChild.copy(pe(t.lastChild.content,e-1,r)))}function de(t,e){for(let r=0;r<e;r++)t=t.firstChild.content;return t}function we(t,e,r){if(e<=0)return t;let n=t.content;if(e>1)n=n.replaceChild(0,we(n.firstChild,e-1,n.childCount==1?r-1:0));if(e>0){n=t.type.contentMatch.fillBefore(n).append(n);if(r<=0)n=n.append(t.type.contentMatch.matchFragment(n).fillBefore(i.empty,true))}return t.copy(n)}function me(t,e,r,i,n){let s=t.node(e),h=n?t.indexAfter(e):t.index(e);if(h==s.childCount&&!r.compatibleContent(s.type))return null;let l=i.fillBefore(s.content,true,h);return l&&!ge(r,s.content,h)?l:null}function ge(t,e,r){for(let i=r;i<e.childCount;i++)if(!t.allowsMarks(e.child(i).marks))return true;return false}function ye(t){return t.spec.defining||t.spec.definingForContent}function Se(t,e,r,i){if(!i.size)return t.deleteRange(e,r);let n=t.doc.resolve(e),s=t.doc.resolve(r);if(oe(n,s,i))return t.step(new Ft(e,r,i));let h=xe(n,t.doc.resolve(r));if(h[h.length-1]==0)h.pop();let l=-(n.depth+1);h.unshift(l);for(let t=n.depth,e=n.pos-1;t>0;t--,e--){let r=n.node(t).type.spec;if(r.defining||r.definingAsContext||r.isolating)break;if(h.indexOf(t)>-1)l=t;else if(n.before(t)==e)h.splice(1,0,-t)}let u=h.indexOf(l);let o=[],a=i.openStart;for(let t=i.content,e=0;;e++){let r=t.firstChild;o.push(r);if(e==i.openStart)break;t=r.content}for(let t=a-1;t>=0;t--){let e=o[t],r=ye(e.type);if(r&&!e.sameMarkup(n.node(Math.abs(l)-1)))a=t;else if(r||!e.type.isTextblock)break}for(let e=i.openStart;e>=0;e--){let l=(e+a+1)%(i.openStart+1);let c=o[l];if(!c)continue;for(let e=0;e<h.length;e++){let o=h[(e+u)%h.length],a=true;if(o<0){a=false;o=-o}let p=n.node(o-1),d=n.index(o-1);if(p.canReplaceWith(d,d,c.type,c.marks))return t.replace(n.before(o),a?s.after(o):r,new f(be(i.content,0,i.openStart,l),l,i.openEnd))}}let c=t.steps.length;for(let l=h.length-1;l>=0;l--){t.replace(e,r,i);if(t.steps.length>c)break;let u=h[l];if(u<0)continue;e=n.before(u);r=s.after(u)}}function be(t,e,r,n,s){if(e<r){let i=t.firstChild;t=t.replaceChild(0,i.copy(be(i.content,e+1,r,n,i)))}if(e>n){let e=s.contentMatchAt(0);let r=e.fillBefore(t).append(t);t=r.append(e.matchFragment(r).fillBefore(i.empty,true))}return t}function ke(t,e,r,n){if(!n.isInline&&e==r&&t.doc.resolve(e).parent.content.size){let i=le(t.doc,e,n.type);if(i!=null)e=r=i}t.replaceRange(e,r,new f(i.from(n),0,0))}function ve(t,e,r){let i=t.doc.resolve(e),n=t.doc.resolve(r);let s=xe(i,n);for(let e=0;e<s.length;e++){let r=s[e],h=e==s.length-1;if(h&&r==0||i.node(r).type.contentMatch.validEnd)return t.delete(i.start(r),n.end(r));if(r>0&&(h||i.node(r-1).canReplace(i.index(r-1),n.indexAfter(r-1))))return t.delete(i.before(r),n.after(r))}for(let s=1;s<=i.depth&&s<=n.depth;s++){if(e-i.start(s)==i.depth-s&&r>i.end(s)&&n.end(s)-r!=n.depth-s)return t.delete(i.before(s),r)}t.delete(e,r)}function xe(t,e){let r=[],i=Math.min(t.depth,e.depth);for(let n=i;n>=0;n--){let i=t.start(n);if(i<t.pos-(t.depth-n)||e.end(n)>e.pos+(e.depth-n)||t.node(n).type.spec.isolating||e.node(n).type.spec.isolating)break;if(i==e.start(n)||n==t.depth&&n==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&n&&e.start(n-1)==i-1)r.push(n)}return r}class Ne extends Tt{constructor(t,e,r){super();this.pos=t;this.attr=e;this.value=r}apply(t){let e=t.nodeAt(this.pos);if(!e)return At.fail("No node at attribute step's position");let r=Object.create(null);for(let t in e.attrs)r[t]=e.attrs[t];r[this.attr]=this.value;let n=e.type.create(r,null,e.marks);return At.fromReplace(t,this.pos,this.pos+1,new f(i.from(n),0,e.isLeaf?0:1))}getMap(){return Rt.empty}invert(t){return new Ne(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new Ne(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.pos!="number"||typeof e.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Ne(e.pos,e.attr,e.value)}}Tt.jsonID("attr",Ne);class Oe extends Tt{constructor(t,e){super();this.attr=t;this.value=e}apply(t){let e=Object.create(null);for(let r in t.attrs)e[r]=t.attrs[r];e[this.attr]=this.value;let r=t.type.create(e,t.content,t.marks);return At.ok(r)}getMap(){return Rt.empty}invert(t){return new Oe(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Oe(e.attr,e.value)}}Tt.jsonID("docAttr",Oe);let Ee=class extends Error{};Ee=function t(e){let r=Error.call(this,e);r.__proto__=t.prototype;return r};Ee.prototype=Object.create(Error.prototype);Ee.prototype.constructor=Ee;Ee.prototype.name="TransformError";class Me{constructor(t){this.doc=t;this.steps=[];this.docs=[];this.mapping=new Jt}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new Ee(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);if(!e.failed)this.addStep(t,e.doc);return e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc);this.steps.push(t);this.mapping.appendMap(t.getMap());this.doc=e}replace(t,e=t,r=f.empty){let i=fe(this.doc,t,e,r);if(i)this.step(i);return this}replaceWith(t,e,r){return this.replace(t,e,new f(i.from(r),0,0))}delete(t,e){return this.replace(t,e,f.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,r){Se(this,t,e,r);return this}replaceRangeWith(t,e,r){ke(this,t,e,r);return this}deleteRange(t,e){ve(this,t,e);return this}lift(t,e){Gt(this,t,e);return this}join(t,e=1){he(this,t,e);return this}wrap(t,e){Xt(this,t,e);return this}setBlockType(t,e=t,r,i=null){Yt(this,t,e,r,i);return this}setNodeMarkup(t,e,r=null,i){te(this,t,e,r,i);return this}setNodeAttribute(t,e,r){this.step(new Ne(t,e,r));return this}setDocAttribute(t,e){this.step(new Oe(t,e));return this}addNodeMark(t,e){this.step(new $t(t,e));return this}removeNodeMark(t,e){if(!(e instanceof l)){let r=this.doc.nodeAt(t);if(!r)throw new RangeError("No node at position "+t);e=e.isInSet(r.marks);if(!e)return this}this.step(new Bt(t,e));return this}split(t,e=1,r){re(this,t,e,r);return this}addMark(t,e,r){Pt(this,t,e,r);return this}removeMark(t,e,r){zt(this,t,e,r);return this}clearIncompatible(t,e,r){Ut(this,t,e,r);return this}}const Re=Object.create(null);class Je{constructor(t,e,r){this.$anchor=t;this.$head=e;this.ranges=r||[new Ie(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return false;return true}content(){return this.$from.doc.slice(this.from,this.to,true)}replace(t,e=f.empty){let r=e.content.lastChild,i=null;for(let t=0;t<e.openEnd;t++){i=r;r=r.lastChild}let n=t.steps.length,s=this.ranges;for(let h=0;h<s.length;h++){let{$from:l,$to:u}=s[h],o=t.mapping.slice(n);t.replaceRange(o.map(l.pos),o.map(u.pos),h?f.empty:e);if(h==0)We(t,n,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(t,e){let r=t.steps.length,i=this.ranges;for(let n=0;n<i.length;n++){let{$from:s,$to:h}=i[n],l=t.mapping.slice(r);let u=l.map(s.pos),f=l.map(h.pos);if(n){t.deleteRange(u,f)}else{t.replaceRangeWith(u,f,e);We(t,r,e.isInline?-1:1)}}}static findFrom(t,e,r=false){let i=t.parent.inlineContent?new je(t):qe(t.node(0),t.parent,t.pos,t.index(),e,r);if(i)return i;for(let i=t.depth-1;i>=0;i--){let n=e<0?qe(t.node(0),t.node(i),t.before(i+1),t.index(i),e,r):qe(t.node(0),t.node(i),t.after(i+1),t.index(i)+1,e,r);if(n)return n}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new Be(t.node(0))}static atStart(t){return qe(t,t,0,0,1)||new Be(t)}static atEnd(t){return qe(t,t,t.content.size,t.childCount,-1)||new Be(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Re[e.type];if(!r)throw new RangeError(`No selection type ${e.type} defined`);return r.fromJSON(t,e)}static jsonID(t,e){if(t in Re)throw new RangeError("Duplicate use of selection JSON ID "+t);Re[t]=e;e.prototype.jsonID=t;return e}getBookmark(){return je.between(this.$anchor,this.$head).getBookmark()}}Je.prototype.visible=true;class Ie{constructor(t,e){this.$from=t;this.$to=e}}let Te=false;function Ae(t){if(!Te&&!t.parent.inlineContent){Te=true;console["warn"]("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")")}}class je extends Je{constructor(t,e=t){Ae(t);Ae(e);super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let r=t.resolve(e.map(this.head));if(!r.parent.inlineContent)return Je.near(r);let i=t.resolve(e.map(this.anchor));return new je(i.parent.inlineContent?i:r,r)}replace(t,e=f.empty){super.replace(t,e);if(e==f.empty){let e=this.$from.marksAcross(this.$to);if(e)t.ensureMarks(e)}}eq(t){return t instanceof je&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new Ce(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if(typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new je(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,r=e){let i=t.resolve(e);return new this(i,r==e?i:t.resolve(r))}static between(t,e,r){let i=t.pos-e.pos;if(!r||i)r=i>=0?1:-1;if(!e.parent.inlineContent){let t=Je.findFrom(e,r,true)||Je.findFrom(e,-r,true);if(t)e=t.$head;else return Je.near(e,r)}if(!t.parent.inlineContent){if(i==0){t=e}else{t=(Je.findFrom(t,-r,true)||Je.findFrom(t,r,true)).$anchor;if(t.pos<e.pos!=i<0)t=e}}return new je(t,e)}}Je.jsonID("text",je);class Ce{constructor(t,e){this.anchor=t;this.head=e}map(t){return new Ce(t.map(this.anchor),t.map(this.head))}resolve(t){return je.between(t.resolve(this.anchor),t.resolve(this.head))}}class De extends Je{constructor(t){let e=t.nodeAfter;let r=t.node(0).resolve(t.pos+e.nodeSize);super(t,r);this.node=e}map(t,e){let{deleted:r,pos:i}=e.mapResult(this.anchor);let n=t.resolve(i);if(r)return Je.near(n);return new De(n)}content(){return new f(i.from(this.node),0,0)}eq(t){return t instanceof De&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new $e(this.anchor)}static fromJSON(t,e){if(typeof e.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new De(t.resolve(e.anchor))}static create(t,e){return new De(t.resolve(e))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==false}}De.prototype.visible=false;Je.jsonID("node",De);class $e{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:r}=t.mapResult(this.anchor);return e?new Ce(r,r):new $e(r)}resolve(t){let e=t.resolve(this.anchor),r=e.nodeAfter;if(r&&De.isSelectable(r))return new De(e);return Je.near(e)}}class Be extends Je{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=f.empty){if(e==f.empty){t.delete(0,t.doc.content.size);let e=Je.atStart(t.doc);if(!e.eq(t.selection))t.setSelection(e)}else{super.replace(t,e)}}toJSON(){return{type:"all"}}static fromJSON(t){return new Be(t)}map(t){return new Be(t)}eq(t){return t instanceof Be}getBookmark(){return Fe}}Je.jsonID("all",Be);const Fe={map(){return this},resolve(t){return new Be(t)}};function qe(t,e,r,i,n,s=false){if(e.inlineContent)return je.create(t,r);for(let h=i-(n>0?0:1);n>0?h<e.childCount:h>=0;h+=n){let i=e.child(h);if(!i.isAtom){let e=qe(t,i,r+n,n<0?i.childCount:0,n,s);if(e)return e}else if(!s&&De.isSelectable(i)){return De.create(t,r-(n<0?i.nodeSize:0))}r+=i.nodeSize*n}return null}function We(t,e,r){let i=t.steps.length-1;if(i<e)return;let n=t.steps[i];if(!(n instanceof Ft||n instanceof qt))return;let s=t.mapping.maps[i],h;s.forEach(((t,e,r,i)=>{if(h==null)h=i}));t.setSelection(Je.near(t.doc.resolve(h),r))}const Pe=1,ze=2,Ue=4;class _e extends Me{constructor(t){super(t.doc);this.curSelectionFor=0;this.updated=0;this.meta=Object.create(null);this.time=Date.now();this.curSelection=t.selection;this.storedMarks=t.storedMarks}get selection(){if(this.curSelectionFor<this.steps.length){this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor));this.curSelectionFor=this.steps.length}return this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");this.curSelection=t;this.curSelectionFor=this.steps.length;this.updated=(this.updated|Pe)&~ze;this.storedMarks=null;return this}get selectionSet(){return(this.updated&Pe)>0}setStoredMarks(t){this.storedMarks=t;this.updated|=ze;return this}ensureMarks(t){if(!l.sameSet(this.storedMarks||this.selection.$from.marks(),t))this.setStoredMarks(t);return this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&ze)>0}addStep(t,e){super.addStep(t,e);this.updated=this.updated&~ze;this.storedMarks=null}setTime(t){this.time=t;return this}replaceSelection(t){this.selection.replace(this,t);return this}replaceSelectionWith(t,e=true){let r=this.selection;if(e)t=t.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||l.none));r.replaceWith(this,t);return this}deleteSelection(){this.selection.replace(this);return this}insertText(t,e,r){let i=this.doc.type.schema;if(e==null){if(!t)return this.deleteSelection();return this.replaceSelectionWith(i.text(t),true)}else{if(r==null)r=e;r=r==null?e:r;if(!t)return this.deleteRange(e,r);let n=this.storedMarks;if(!n){let t=this.doc.resolve(e);n=r==e?t.marks():t.marksAcross(this.doc.resolve(r))}this.replaceRangeWith(e,r,i.text(t,n));if(!this.selection.empty)this.setSelection(Je.near(this.selection.$to));return this}}setMeta(t,e){this.meta[typeof t=="string"?t:t.key]=e;return this}getMeta(t){return this.meta[typeof t=="string"?t:t.key]}get isGeneric(){for(let t in this.meta)return false;return true}scrollIntoView(){this.updated|=Ue;return this}get scrolledIntoView(){return(this.updated&Ue)>0}}function Le(t,e){return!e||!t?t:t.bind(e)}class Ge{constructor(t,e,r){this.name=t;this.init=Le(e.init,r);this.apply=Le(e.apply,r)}}const Ve=[new Ge("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Ge("selection",{init(t,e){return t.selection||Je.atStart(e.doc)},apply(t){return t.selection}}),new Ge("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,r,i){return i.selection.$cursor?t.storedMarks:null}}),new Ge("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class He{constructor(t,e){this.schema=t;this.plugins=[];this.pluginsByKey=Object.create(null);this.fields=Ve.slice();if(e)e.forEach((t=>{if(this.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");this.plugins.push(t);this.pluginsByKey[t.key]=t;if(t.spec.state)this.fields.push(new Ge(t.key,t.spec.state,t))}))}}class Ke{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,e=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=e){let e=this.config.plugins[r];if(e.spec.filterTransaction&&!e.spec.filterTransaction.call(e,t,this))return false}return true}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let e=[t],r=this.applyInner(t),i=null;for(;;){let n=false;for(let s=0;s<this.config.plugins.length;s++){let h=this.config.plugins[s];if(h.spec.appendTransaction){let l=i?i[s].n:0,u=i?i[s].state:this;let f=l<e.length&&h.spec.appendTransaction.call(h,l?e.slice(l):e,u,r);if(f&&r.filterTransaction(f,s)){f.setMeta("appendedTransaction",t);if(!i){i=[];for(let t=0;t<this.config.plugins.length;t++)i.push(t<s?{state:r,n:e.length}:{state:this,n:0})}e.push(f);r=r.applyInner(f);n=true}if(i)i[s]={state:r,n:e.length}}}if(!n)return{state:r,transactions:e}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let e=new Ke(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let n=r[i];e[n.name]=n.apply(t,this[n.name],this,e)}return e}get tr(){return new _e(this)}static create(t){let e=new He(t.doc?t.doc.type.schema:t.schema,t.plugins);let r=new Ke(e);for(let i=0;i<e.fields.length;i++)r[e.fields[i].name]=e.fields[i].init(t,r);return r}reconfigure(t){let e=new He(this.schema,t.plugins);let r=e.fields,i=new Ke(e);for(let e=0;e<r.length;e++){let n=r[e].name;i[n]=this.hasOwnProperty(n)?this[n]:r[e].init(t,i)}return i}toJSON(t){let e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks)e.storedMarks=this.storedMarks.map((t=>t.toJSON()));if(t&&typeof t=="object")for(let r in t){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=t[r],n=i.spec.state;if(n&&n.toJSON)e[r]=n.toJSON.call(i,this[i.key])}return e}static fromJSON(t,e,r){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let i=new He(t.schema,t.plugins);let n=new Ke(i);i.fields.forEach((i=>{if(i.name=="doc"){n.doc=R.fromJSON(t.schema,e.doc)}else if(i.name=="selection"){n.selection=Je.fromJSON(n.doc,e.selection)}else if(i.name=="storedMarks"){if(e.storedMarks)n.storedMarks=e.storedMarks.map(t.schema.markFromJSON)}else{if(r)for(let s in r){let h=r[s],l=h.spec.state;if(h.key==i.name&&l&&l.fromJSON&&Object.prototype.hasOwnProperty.call(e,s)){n[i.name]=l.fromJSON.call(h,t,e[s],n);return}}n[i.name]=i.init(t,n)}}));return n}}function Qe(t,e,r){for(let i in t){let n=t[i];if(n instanceof Function)n=n.bind(e);else if(i=="handleDOMEvents")n=Qe(n,e,{});r[i]=n}return r}class Xe{constructor(t){this.spec=t;this.props={};if(t.props)Qe(t.props,this,this.props);this.key=t.key?t.key.key:Ze("plugin")}getState(t){return t[this.key]}}const Ye=Object.create(null);function Ze(t){if(t in Ye)return t+"$"+ ++Ye[t];Ye[t]=0;return t+"$"}class tr{constructor(t="key"){this.key=Ze(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}export{Be as A,wt as D,Ke as E,i as F,l as M,De as N,tr as P,qt as R,Je as S,je as T,f as a,Z as b,X as c,ue as d,E as e,Vt as f,ee as g,ie as h,Xe as i,Jt as j,se as k,Lt as l,R as m,fe as r};
//# sourceMappingURL=index-5d321d41.js.map