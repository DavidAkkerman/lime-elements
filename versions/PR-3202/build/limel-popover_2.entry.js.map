{"version":3,"names":["portalContains","element","child","contains","_a","shadowRoot","parent","findParent","portal","closest","portalSource","rootNode","getRootNode","host","popoverCss","HOVER_TRIGGER_DELAY","Popover","constructor","hostRef","this","togglePopover","open","handleMouseEnter","hoverTimeout","window","setTimeout","handleMouseLeave","clearTimeout","handleGlobalKeyPress","event","key","ESCAPE","stopPropagation","preventDefault","close","emit","setTriggerAttributes","attributes","portalId","role","value","Object","entries","removeAttribute","setAttribute","String","createRandomString","globalClickListener","bind","watchOpen","setupGlobalHandlers","componentWillLoad","componentDidRender","slotElement","querySelector","assignedElements","forEach","triggerInteraction","setupHoverListeners","setupClickListener","document","addEventListener","capture","removeEventListener","triggerElement","teardownListeners","watchTriggerInteraction","render","cssProperties","getCssProperties","popoverZIndex","getComputedStyle","getPropertyValue","h","class","name","visible","containerId","containerStyle","openDirection","contentCollection","children","style","target","clickedInside","propertyNames","values","map","property","zipObject","popoverSurfaceCss","PopoverSurface","componentDidLoad","appendElement","tabindex","portalContainer","Array","from","slot","appendChild"],"sources":["./src/components/portal/contains.ts","./src/components/popover/popover.scss?tag=limel-popover&encapsulation=shadow","./src/components/popover/popover.tsx","./src/components/popover-surface/popover-surface.scss?tag=limel-popover-surface&encapsulation=shadow","./src/components/popover-surface/popover-surface.tsx"],"sourcesContent":["/**\n * Check if an element is a descendant of another\n *\n * If the child element is a descendant of a limel-portal, this function will\n * go back through the portal and check the original tree recursively\n *\n * @param element - the parent element\n * @param child - the child element to check\n * @returns `true` if child is a descendant of element, taking\n * portals into account\n */\nexport function portalContains(\n    element: HTMLElement,\n    child: HTMLElement,\n): boolean {\n    if (element.contains(child) || element.shadowRoot?.contains(child)) {\n        return true;\n    }\n\n    const parent = findParent(child);\n    if (!parent) {\n        return false;\n    }\n\n    return portalContains(element, parent);\n}\n\nfunction findParent(element: HTMLElement) {\n    const portal: any = element.closest('.limel-portal--container');\n    if (portal) {\n        return portal.portalSource;\n    }\n\n    const rootNode = element.getRootNode() as ShadowRoot;\n\n    return rootNode.host;\n}\n","/**\n * @prop --popover-surface-width: Width of the popover surface. defaults to `auto`\n * @prop --popover-body-background-color: Background color of popover body, defaults to `--lime-elevated-surface-background-color`.\n * @prop --popover-border-radius: Border radius of popover, defaults to `0.75rem`.\n * @prop --popover-z-index: z-index of the popover.\n */\n\n.trigger-anchor {\n    display: inline-block;\n    position: relative;\n}\n","import {\n    Component,\n    h,\n    Prop,\n    Element,\n    Event,\n    EventEmitter,\n    Watch,\n} from '@stencil/core';\nimport { createRandomString } from '../../util/random-string';\nimport { zipObject } from 'lodash-es';\nimport { portalContains } from '../portal/contains';\nimport { ESCAPE } from '../../util/keycodes';\nimport { OpenDirection } from '../menu/menu.types';\n\nconst HOVER_TRIGGER_DELAY = 400;\n\n/**\n * A popover is an impermanent layer that is displayed on top of other content\n * when user taps an element that triggers the popover. This element can be\n * practically anything, a button, piece of text, and icon, etc.\n *\n * Popovers are nonmodal, thus they don't have a semi-transparent backdrop layer\n * that darkens the content below them. Also for the same reason, they can be\n * dismissed by tapping or clicking another part of the screen, but not by a\n * clicking a button or link on the popover itself.\n *\n * :::warning\n * The component is emitting a close event when you click outside its container\n * or press the <kbd>Esc</kbd> key. However, itâ€™s up to you as consumer to react\n * properly on this event and hide the component (preferably by setting the\n * property `open` to `false`).\n * :::\n *\n * ## Usage\n * Use a popover to show **options** or **information** related to the trigger\n * onscreen. A typical use case for popovers is a tooltip, in which you show\n * help text or contextual information to users.\n *\n * Popovers are most appropriate on larger screens but can be used on smaller\n * screens too, as long as their content is responsive and takes into account\n * the context they are displayed on.\n *\n * When a popover is displayed, interactions with other controls are blocked,\n * until user dismisses the popover.\n *\n *\n * ## Layout\n * Popovers has only one slot in which you can import a custom web-component.\n *\n * :::note\n * You must make sure that web-components that you import into the slot has\n * a `width: 100%;` style so that it can horizontally stretch across the popover.\n *\n * However, `width` of the popover can be controlled by specifying a CSS variable\n * of `--popover-surface-width`. If you don't specify any width, the popover\n * will grow as wide as its content.\n * :::\n *\n * :::important\n * Do not make a popover too big. They should never take over the entire screen.\n * If your content is that big, you should probably be using a Modal instead.\n * :::\n *\n * @slot - Content to put inside the surface\n * @exampleComponent limel-example-popover\n * @exampleComponent limel-example-popover-trigger-interaction\n */\n@Component({\n    tag: 'limel-popover',\n    shadow: true,\n    styleUrl: 'popover.scss',\n})\nexport class Popover {\n    /**\n     * True if the content within the popover should be visible\n     */\n    @Prop()\n    public open = false;\n\n    /**\n     * Decides the popover's location in relation to its trigger\n     */\n    @Prop({ reflect: true })\n    public openDirection: OpenDirection;\n\n    /**\n     * Define whether the popover should be triggered by click or hover.\n     * - `click` will open the popover when the trigger is clicked or tapped\n     * - `hover` will open the popover when the trigger is hovered over using a pointing device\n     */\n    @Prop({ reflect: true })\n    public triggerInteraction: 'click' | 'hover' = 'click';\n\n    /**\n     * Emits an event when the component is closing\n     */\n    @Event()\n    private close: EventEmitter<void>;\n\n    @Element()\n    private host: HTMLLimelPopoverElement;\n\n    private portalId: string;\n\n    constructor() {\n        this.portalId = createRandomString();\n        this.globalClickListener = this.globalClickListener.bind(this);\n    }\n\n    @Watch('open')\n    protected watchOpen() {\n        this.setupGlobalHandlers();\n    }\n\n    public componentWillLoad() {\n        this.setupGlobalHandlers();\n    }\n\n    public componentDidRender() {\n        const slotElement = this.host.shadowRoot.querySelector('slot');\n        slotElement.assignedElements().forEach(this.setTriggerAttributes);\n\n        if (this.triggerInteraction === 'hover') {\n            this.setupHoverListeners(slotElement);\n        } else {\n            this.setupClickListener(slotElement);\n        }\n    }\n\n    private setupGlobalHandlers() {\n        if (this.open) {\n            document.addEventListener('click', this.globalClickListener, {\n                capture: true,\n            });\n            document.addEventListener('keyup', this.handleGlobalKeyPress);\n        } else {\n            document.removeEventListener('click', this.globalClickListener);\n            document.removeEventListener('keyup', this.handleGlobalKeyPress);\n        }\n    }\n\n    private setupClickListener(slotElement: HTMLSlotElement) {\n        slotElement\n            .assignedElements()\n            .forEach((triggerElement: HTMLElement) => {\n                triggerElement.addEventListener('click', this.togglePopover);\n            });\n    }\n\n    private setupHoverListeners(slotElement: HTMLSlotElement) {\n        slotElement\n            .assignedElements()\n            .forEach((triggerElement: HTMLElement) => {\n                triggerElement.addEventListener(\n                    'mouseenter',\n                    this.handleMouseEnter,\n                );\n                triggerElement.addEventListener(\n                    'mouseleave',\n                    this.handleMouseLeave,\n                );\n            });\n    }\n\n    private teardownListeners(slotElement: HTMLSlotElement) {\n        slotElement\n            .assignedElements()\n            .forEach((triggerElement: HTMLElement) => {\n                triggerElement.removeEventListener('click', this.togglePopover);\n                triggerElement.removeEventListener(\n                    'mouseenter',\n                    this.handleMouseEnter,\n                );\n                triggerElement.removeEventListener(\n                    'mouseleave',\n                    this.handleMouseLeave,\n                );\n            });\n    }\n\n    @Watch('triggerInteraction')\n    protected watchTriggerInteraction() {\n        const slotElement = this.host.shadowRoot.querySelector('slot');\n        this.teardownListeners(slotElement);\n        this.componentDidRender();\n    }\n\n    private hoverTimeout: number;\n\n    public render() {\n        const cssProperties = this.getCssProperties();\n        const popoverZIndex = getComputedStyle(this.host).getPropertyValue(\n            '--popover-z-index',\n        );\n\n        return (\n            <div class=\"trigger-anchor\">\n                <slot name=\"trigger\" />\n                <limel-portal\n                    visible={this.open}\n                    containerId={this.portalId}\n                    containerStyle={{ 'z-index': popoverZIndex }}\n                    openDirection={this.openDirection}\n                >\n                    <limel-popover-surface\n                        contentCollection={this.host.children}\n                        style={cssProperties}\n                    />\n                </limel-portal>\n            </div>\n        );\n    }\n\n    private togglePopover = () => {\n        this.open = !this.open;\n    };\n\n    private globalClickListener(event: MouseEvent) {\n        const element: HTMLElement = event.target as HTMLElement;\n        const clickedInside = portalContains(this.host, element);\n        if (this.open && !clickedInside) {\n            event.stopPropagation();\n            event.preventDefault();\n            this.close.emit();\n        }\n    }\n\n    private handleMouseEnter = () => {\n        this.hoverTimeout = window.setTimeout(() => {\n            this.open = true;\n        }, HOVER_TRIGGER_DELAY);\n    };\n\n    private handleMouseLeave = () => {\n        clearTimeout(this.hoverTimeout);\n    };\n\n    private getCssProperties() {\n        const propertyNames = [\n            '--popover-surface-width',\n            '--popover-body-background-color',\n            '--popover-border-radius',\n        ];\n        const style = getComputedStyle(this.host);\n        const values = propertyNames.map((property) => {\n            return style.getPropertyValue(property);\n        });\n\n        return zipObject(propertyNames, values);\n    }\n\n    private handleGlobalKeyPress = (event: KeyboardEvent) => {\n        if (event.key !== ESCAPE) {\n            return;\n        }\n\n        event.stopPropagation();\n        event.preventDefault();\n        this.close.emit();\n    };\n\n    private setTriggerAttributes = (element: HTMLElement) => {\n        const attributes = {\n            'aria-haspopup': true,\n            'aria-expanded': this.open,\n            'aria-controls': this.portalId,\n            role: 'button',\n        };\n\n        for (const [key, value] of Object.entries(attributes)) {\n            if (!value) {\n                element.removeAttribute(key);\n            } else {\n                element.setAttribute(key, String(value));\n            }\n        }\n    };\n}\n","@use '../../style/functions';\n@use '../../style/mixins';\n\n:host(limel-popover-surface) {\n    isolation: isolate;\n\n    position: relative;\n    display: flex;\n\n    width: var(--popover-surface-width, auto);\n    max-height: inherit; // inherits it from the dynamically calculated `max-height` of `limel-portal--container`\n    max-width: calc(100vw - 2rem);\n    margin: 0 0.25rem;\n}\n\n.limel-popover-surface {\n    flex: 1;\n    min-width: 0;\n    min-height: 0;\n    border-radius: var(--popover-border-radius, functions.pxToRem(12));\n    box-shadow: var(--shadow-depth-16);\n\n    backdrop-filter: blur(functions.pxToRem(5));\n    -webkit-backdrop-filter: blur(functions.pxToRem(5));\n\n    &:after {\n        // allows using `--popover-body-background-color` while\n        // getting the blurred backdrop effect\n        transition: opacity 0.4s ease;\n        pointer-events: none;\n\n        content: '';\n        position: absolute;\n        top: 0;\n        right: 0;\n        bottom: 0;\n        left: 0;\n        z-index: -1;\n\n        opacity: 0.75;\n\n        border-radius: var(--popover-border-radius, functions.pxToRem(12));\n        background-color: var(\n            --popover-body-background-color,\n            var(--lime-elevated-surface-background-color)\n        );\n    }\n\n    @include mixins.visualize-keyboard-focus;\n\n    &:focus,\n    &:focus-within {\n        &:after {\n            opacity: 1;\n        }\n    }\n\n    & > * {\n        // this fixes some unwanted layout issues\n        // which might be very hard for consumers to realize\n        // and fix by themselves. Without this code,\n        // if the consumer sets for example paddings in\n        // what they send to the popover, their element\n        // can grow larger than the popover surface\n        box-sizing: border-box;\n    }\n}\n","import { Component, h, Prop, Element } from '@stencil/core';\n\n/**\n * @slot - Content to put inside the surface\n * @private\n */\n\n@Component({\n    tag: 'limel-popover-surface',\n    shadow: true,\n    styleUrl: 'popover-surface.scss',\n})\nexport class PopoverSurface {\n    /**\n     * Content to render\n     */\n    @Prop()\n    public contentCollection: HTMLCollection;\n\n    @Element()\n    private host: HTMLLimelPopoverSurfaceElement;\n\n    public componentDidLoad() {\n        this.appendElement();\n    }\n\n    public render() {\n        return <div class=\"limel-popover-surface\" tabindex=\"0\" />;\n    }\n\n    private appendElement() {\n        const portalContainer = this.host.shadowRoot.querySelector(\n            '.limel-popover-surface',\n        );\n\n        Array.from(this.contentCollection).forEach((child) => {\n            if (child.slot === 'trigger') {\n                return;\n            }\n\n            portalContainer.appendChild(child);\n        });\n    }\n}\n"],"mappings":"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"}